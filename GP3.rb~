#http://you.ctrip.com/CommunitySite/Activity/Home/IndexList post page=3

# encoding : utf-8
require 'nokogiri'
require 'open-uri'
fh = File.new("list.out", "w")  #创建一个可写文件流 
html=open("http://you.ctrip.com/CommunitySite/Activity/Home/IndexList?page=1").read
#html=open("http://you.ctrip.com/events/").read
	#charset=Nokogiri::HTML(html).meta_encoding#！有些网页没有定义charset则不适用
	##puts charset 	#打印当前页面编码格式-utf8 否则转码
	#html.force_encoding(charset)
	#html.encode!("utf-8", :undef => :replace, :replace => "?", :invalid => :replace)
doc = Nokogiri::HTML.parse html

#找到这个div IndexListPage 然后获取其中数据
doc = doc.css("#events_list_content > ul")
doc =doc.to_s
#puts doc =~ /href(.*)html/    #返回找到的第一个索引
 
doc.scan(/href="(.*)html/).each{
  |m|#/events/dali31/4127074.
  fh.puts"http://you.ctrip.com/#{m[0]}html"
} 

#x = doc.match(/href(.*)html/) #返回找到的第一个匹配项
#puts x.to_a
#忘记了  x.captures.each{ |item| puts( item ) }
#打印匹配之后剩余的串　puts   x.post_match.to_a 
#puts "-=123a" =~  /\w/ # 2 匹配字母  测试正则匹配
#fh.puts doc #写入数据
fh.close #关闭文件流
